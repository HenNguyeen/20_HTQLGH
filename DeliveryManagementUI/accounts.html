<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Tài Khoản - Delivery Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-shipping-fast"></i>
            <h4>Quản Lý Giao Hàng</h4>
        </div>
        <ul class="sidebar-menu">
            <li><a href="index.html"><i class="fas fa-home"></i><span>Dashboard</span></a></li>
            <li><a href="orders.html"><i class="fas fa-box"></i><span>Đơn Hàng</span></a></li>
            <li><a href="staff.html"><i class="fas fa-users"></i><span>Nhân Viên</span></a></li>
            <li class="active"><a href="accounts.html"><i class="fas fa-user-shield"></i><span>Tài Khoản</span></a></li>
            <li><a href="tracking.html"><i class="fas fa-map-marked-alt"></i><span>Theo Dõi GPS</span></a></li>
        </ul>
    </div>

    <div class="main-content">
        <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
            <div class="container-fluid">
                <button class="btn btn-link" id="sidebarToggle"><i class="fas fa-bars"></i></button>
                <div class="ms-auto d-flex align-items-center">
                    <div class="dropdown">
                        <button class="btn btn-link dropdown-toggle text-decoration-none" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle fa-lg me-2"></i>
                            <span class="user-name">User</span>
                            <span class="user-role badge bg-primary ms-2">Role</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><h6 class="dropdown-header"><span class="user-name">User</span></h6></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="auth.logout()"><i class="fas fa-sign-out-alt me-2"></i>Đăng xuất</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container-fluid p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-user-shield"></i> Quản Lý Tài Khoản</h2>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createUserModal">
                    <i class="fas fa-user-plus"></i> Tạo Tài Khoản
                </button>
            </div>

            <div class="card mb-3">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Tìm kiếm</label>
                            <input type="text" id="searchUsers" class="form-control" placeholder="Tên, username, email, SĐT">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Vai trò</label>
                            <select id="roleFilter" class="form-select">
                                <option value="">Tất cả</option>
                                <option value="admin">Admin</option>
                                <option value="shipper">Shipper</option>
                                <option value="customer">Customer</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button class="btn btn-secondary w-100" onclick="resetUserFilters()"><i class="fas fa-redo"></i> Đặt lại</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>#</th><th>Username</th><th>Họ Tên</th><th>Email</th><th>SĐT</th><th>Vai Trò</th><th>Thao Tác</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr><td colspan="7" class="text-center py-4"><div class="spinner-border" role="status"><span class="visually-hidden">Đang tải...</span></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create User Modal -->
    <div class="modal fade" id="createUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title"><i class="fas fa-user-plus"></i> Tạo Tài Khoản</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="createUserForm">
                        <div class="mb-2"><label class="form-label">Username *</label><input type="text" class="form-control" name="username" required></div>
                        <div class="mb-2"><label class="form-label">Mật khẩu</label><input type="text" class="form-control" name="password" placeholder="Mặc định 123456"></div>
                        <div class="mb-2"><label class="form-label">Họ Tên</label><input type="text" class="form-control" name="fullName"></div>
                        <div class="mb-2"><label class="form-label">Email</label><input type="email" class="form-control" name="email"></div>
                        <div class="mb-2"><label class="form-label">SĐT</label><input type="tel" class="form-control" name="phoneNumber"></div>
                        <div class="mb-2"><label class="form-label">Vai trò *</label>
                            <select class="form-select" name="role" required>
                                <option value="customer">Customer</option>
                                <option value="shipper">Shipper</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary" onclick="createUser()"><i class="fas fa-save"></i> Tạo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title"><i class="fas fa-user-edit"></i> Sửa Tài Khoản</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="hidden" id="editUserId">
                    <form id="editUserForm">
                        <div class="mb-2"><label class="form-label">Họ Tên</label><input type="text" class="form-control" name="fullName"></div>
                        <div class="mb-2"><label class="form-label">Email</label><input type="email" class="form-control" name="email"></div>
                        <div class="mb-2"><label class="form-label">SĐT</label><input type="tel" class="form-control" name="phoneNumber"></div>
                        <div class="mb-2"><label class="form-label">Vai trò</label>
                            <select class="form-select" name="role">
                                <option value="customer">Customer</option>
                                <option value="shipper">Shipper</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary" onclick="saveUserEdit()"><i class="fas fa-save"></i> Lưu</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div class="modal fade" id="resetPasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title"><i class="fas fa-key"></i> Đặt Lại Mật Khẩu</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="hidden" id="resetUserId">
                    <div class="mb-2"><label class="form-label">Mật khẩu mới</label><input type="text" id="newPassword" class="form-control" placeholder="Mặc định 123456 nếu để trống"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-warning" onclick="confirmResetPassword()"><i class="fas fa-rotate"></i> Đặt lại</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/api-service.js"></script>
    <script src="js/accounts.js"></script>
</body>
<!-- Simple inline style to ensure table buttons look good -->
</html>
